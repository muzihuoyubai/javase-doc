

# 引言

## 前置知识

学习本次课需要具备

- 基本的命令行操作技能
- github.com 注册账号

## 学习目的

软件开发或者学习阶段，都需要一款软件版本管理工具。因为编写代码总是需要频繁的修改文件，很可能需要找到修改了很多次以前的某个版本的代码，使用版本管理工具可以存储、追踪目录下文件的修改历史，便于回溯和回退代码，同时便于多个开发者协同开发。因此掌握一个软件版本工具的使用是非常必要的。Git是现在非常流行的一个软件版本管理工具，github上托管着数量巨大的开源代码项目，学习这些内容将对以后编写和学习代码有着巨大的帮助。

## 课程结构

1. 介绍git的工作流，工作区、暂存区、仓库的概念
2. 创建本地的git仓库，添加、提交代码到仓库（以及相关的撤销操作）的相关命令
3. 介绍github和远程仓库的创建
4. 将本地仓库和远程仓库关联进行代码同步

## 学习目标

学习本次课后，学员将

* 能够使用git管理自己的代码
* 能够将代码同步到github

# Git

Git是一个开源的分布式版本控制系统，在多人开发过程中，通常大家把代码记录提交到一个中心仓库，所有人从中心仓库更新代码。这样一旦中心仓库的服务器出现故障，就可能导致代码之前的历史记录丢失。分布式指的是每个参与的开发者都记录了仓库的所有历史，这样即便中心仓库故障，也可以使用任意一个开发者的计算机的记录快速回复中心仓库的内容。

## Git的安装

到官网 https://git-scm.com/ 下载对应操作系统的安装包执行，按照提示即可完成git的安装

以下介绍如何确认安装是否成功。

### Windows上使用git

运行git安装包，根据提示安装成功后。鼠标右键菜单中可以看到如下内容，点击Git Bash，开启命令行窗口进行使用。

![images](https://raw.githubusercontent.com/muzihuoyubai/javase-doc/master/00.%E5%B7%A5%E5%85%B7/git_01.png)

### Mac上使用git

运行git安装包，根据提示安装成功后。进入终端界面即可使用。可以使用`git --version`查看git是否安装成功

输出类似以下内容表示安装成功

```
git version 2.23.0
```

## 基本工作流

![image-20200306174433200](/Users/liyi/works/repos/javase-doc/00.工具/git_02.png)

- 工作区working directory：指的是代码文件

- 暂存区stage：存放工作区的代码的快照

- 本地仓库repository：记录所有的提交(commit)的历史记录

### 初始化仓库

git使用仓库(repository)作为管理代码的根目录，这个目录里面的所有文件都可以被Git管理，文件的新增、修改、删除都会被Git跟踪。可以查看文件变更的历史或者在将来某个时刻还可以将文件还原。

进入到想要成为git仓库的文件夹下，运行以下命令创建一个git仓库

```
git init
```

创建成功后，当前文件夹下面将会生成一个`.git`的隐藏文件夹，所有的文件变更历史都保存在这个文件夹下，其中还包含了当前仓库的一些配置信息。

### 查看状态

仓库创建成功后，可以使用`status`查看仓库路径下的文件状态。

```
git status
```

常见状态有以下几种

工作区干净，表示工作区-暂存区-本地仓库记录的文件内容一致

```
nothing to commit, working tree clean
```



文件未暂存，表示工作区内容比暂存区以及本地仓库记录要更新

```
Changes not staged for commit:
  (use "git add <file>..." to update what will be committed)
  (use "git checkout -- <file>..." to discard changes in working directory)

    modified:   readme.txt
```



文件为提交，表示工作区内容和暂存区内容一致，比本地仓库记录要新

```
Changes to be committed:
  (use "git reset HEAD <file>..." to unstage)

    modified:   readme.txt
```



### 比较差异

使用`git diff` 比较各个区域的文件内容的差异

| 命令              | 作用               |
| :---------------- | :----------------- |
| git diff          | 工作区 vs 暂存区   |
| git diff head     | 工作区 vs 本地仓库 |
| git diff --cached | 暂存区 vs 本地仓库 |

### 暂存

#### 添加暂存

在工作区对文件进行增、删、改之后，git可以感知到工作区代码基于暂存区和仓库版本的变化，如果需要保存此刻的文件内容，需要添加暂存。暂存动作相当于对这一时刻的文件进行快照，将这时刻的文件内容保存到暂存区。可以将多个文件添加到暂存区用空格隔开，同一个文件多次添加，只保留最后一次的快照。使用`add`命令(`stage`也可以是等价的)

```
git add <文件名> <文件名>
```

注意，可以再添加完暂存之后再继续编辑文件。暂存区保存了添加暂存那一时刻的代码内容。add命令有很多参数和通配符帮助提高效率，如下

| 命令           | 作用                                                         |
| -------------- | ------------------------------------------------------------ |
| git add 文件名 | 将文件添加的暂存区，多个文件空格分隔，可以使用相对路径或绝对路径 |
| git add 文件夹 | 将文件夹下的文件全部添加到暂存区                             |
| git add *.c    | 将所有以.c为后缀的文件添加到暂存区                           |
| git add -A     | 新增、修改和删除的文件添加到暂存区                           |
| git add .      | 新增、修改的文件添加到暂存区                                 |
| git add -u     | 修改、删除的文件添加到暂存区                                 |

#### 取消暂存

如果添加暂存有误，可以使用使用reset命令取消暂存，将使用仓库中的文件内容覆盖暂存区内容

| 命令             | 作用                         |
| ---------------- | ---------------------------- |
| git reset 文件名 | 本地仓库文件状态->暂存区     |
| git reset        | 本地仓库所有文件状态->暂存区 |
| git reset HEAD   | 同 git reset                 |

### 提交

提交(commit)将暂存区的所有代码快照提交到本地仓库，每次commit都会生成唯一的一个id用来标识当前提交的代码记录。可以使用`a`参数包含暂存操作。提交的时候必须使用`m`参数指定对这次提交的说明

| 命令                        | 作用                     |
| --------------------------- | ------------------------ |
| git commit -m "提交的描述"  | 暂存区->本地仓库         |
| git commit -am "提交的描述" | 工作区->暂存区->本地仓库 |

#### 提交记录

查看所有的提交历史记录

```console
git log
```

输出

```console
commit ca82a6dff817ec66f44342007202690a93763949  (HEAD -> master, origin/master)
Author: banyuan <banyuan@banyuan.club>
Date:   Thu Dec 12 20:11:58 2019 +0800

    第三次提交

commit 085bb3bcb608e1e8451d4b2432f8ecbe6306e7e7
Author: banyuan <banyuan@banyuan.club>
Date:   Thu Dec 12 20:08:32 2019 +0800

    第二次提交

commit a11bef06a3f659402fe7563abf99ad00de2209e6
Author: banyuan <banyuan@banyuan.club>
Date:   Wed Dec 11 22:07:34 2019 +0800

    第一次提交
```



commit后面一串字符串代表commit id，每次commit都会接着上一次commit，形成一个链条，git中使用`HEAD`标识当前仓库代码所在的commit，通常HEAD总是指向最新的一次commit，一个commit只能有一个父级的commit节点，但是可以有多个子的commit节点，commit的历史记录按照一个树形的结构展开，这就是git的分支。初始化仓库之后提交会产生一个默认的分支，被叫做`master`(主干分支)。

#### 撤销提交

撤销提交本质上是移动HEAD指向的commit，移动后，HEAD指向的commit之后提交的内容都将被忽略掉，使用`reset`命令进行相关操作。

| 命令             | 作用                                           |
| ---------------- | ---------------------------------------------- |
| git reset 提交ID | HEAD->提交ID, 提交ID->暂存区                   |
| git reset HEAD~  | HEAD指向上一个提交，HEAD(即上一个提交)->暂存区 |
| git reset HEAD^  | HEAD指向上一个提交，HEAD(即上一个提交)->暂存区 |
| git reset HEAD~n | HEAD指向上n个提交，HEAD(即上n个提交)->暂存区   |

如果上述命令后面增加`--hard`，同时会将更新后暂存区的内容写到工作区，工作区修改的内容将会丢失

如果上述命令后面增加`--soft`，仅仅会切换HEAD指向的commit，不会更新暂存区

### 还原历史

通过以下命令还原工作区的文件内容，可以还原任意commit历史记录中的文件快照。

| 命令                    | 作用                                                         |
| ----------------------- | ------------------------------------------------------------ |
| git checkout 文件名     | 暂存区 -> 工作区                                             |
| git reset 文件名        | HEAD->暂存区, reset后面跟文件名 不能使用hard 或 soft参数     |
| git reset 提交ID 文件名 | 提交ID->暂存区，HEAD不变, reset后面跟文件名 不能使用hard 或 soft参数 |

### 多人协作

只需要将本地仓库所有的commit历史记录同步到另外的计算机，就可以完成代码的同步。通常需要一台计算机的git仓库作为中心仓库。每个人将自己的commit推送到中心仓库，其他人拉取commit的变更，来完成多人协作。

| 命令                                            | 作用                                                         |
| ----------------------------------------------- | ------------------------------------------------------------ |
| git clone <版本库的网址>                        | 本地主机生成一个目录，与远程主机的版本库同名，生成本地仓库，暂存区，工作区 |
| git clone <版本库的网址> <指定本地目录名>       | 本地主机生成指定名称目录，生成本地仓库，暂存区，工作区       |
| git remote add <主机名> <网址>                  | 添加远程主机                                                 |
| git remote rm <主机名>                          | 移除远程主机                                                 |
| git fetch <远程主机名>                          | 所有的变更取回本地仓，仅有一个远程主机的时候，主机名可以省略 |
| git pull <远程主机名> <远程分支名>:<本地分支名> | 取回远程主机某个分支的更新，再与本地的指定分支合并， 本地分支名可以省略，默认使用本地仓库中当前的分支，如果配置中保存了远程主机信息，可以简写为 `git pull` |
| git push <远程主机名> <本地分支名>:<远程分支名> | 将本地分支的更新，推送到远程主机，本地分支名可以省略，默认使用本地仓库中当前的分支，如果配置中保存了remote信息，可以简写为 `git push` |



# Github

GitHub（github.com）是一个面向开源及私有软件项目的托管平台，我们可以在平台上建立远程仓库，多人使用这个远程仓库完成协作。

## 同步代码到github

### github建立仓库

1. 进入到个人主页面，选择新建仓库

![image](http://by-camp.oss-cn-shanghai.aliyuncs.com/wiki/prepare/git_teach_05.png)

2. 输入仓库名称，点击创建仓库按钮

![image](http://by-camp.oss-cn-shanghai.aliyuncs.com/wiki/prepare/git_teach_06.png)

3. 复制创建出来的空仓库地址

![image](http://by-camp.oss-cn-shanghai.aliyuncs.com/wiki/prepare/git_teach_07.png)

### 本地仓库和远程仓库关联

进入到本地仓库文件夹中，执行如下命令，关联远程仓库

```
git remote add origin https://github.com/engine-lion/gitdemo.git
```

其中`origin`是自定义的名称，用于代表后面的远程仓库

### 推送本地的提交记录

使用`git push -u origin master`将本地所有的提交记录同步到github仓库中。同步完成后刷新github仓库页面，可以发现文件更新到页面上。`-u`参数表示记录推送的远程路径和分支，下次只需要使用`git push`进行推送即可。`origin`表示之前关联时定义的远程仓库名称，`master`表示推送到远程的主干分支上。

### 复制远程仓库到本地

对于没有代码的计算机，使用`git clone`复制远程的仓库到本地。

```
git clone https://github.com/engine-lion/gitdemo.git
```

这样会在本地创建一个名为`gitdemo`文件夹，其中就是git仓库。

### 同步远程仓库代码到本地

如果关联了远程仓库，可以使用`git pull`将远程仓库中更新的代码同步到本地，这个操作将会把远程仓库中修改的内容直接合并到工作区中。